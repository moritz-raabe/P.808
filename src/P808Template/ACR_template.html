<!--
/*---------------------------------------------------------------------------------------------
*  Copyright (c) Microsoft Corporation. All rights reserved.
*  Licensed under the MIT License. See License.txt in the project root for license information.
*--------------------------------------------------------------------------------------------*/
@author: Babak Naderi
-->

<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8">
</head>



<style type="text/css">
body{font-family:Tahoma,"Times New Roman", Times, serif;}

.table th, .table td {
     border-top: none !important;
}
.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 30%;
}

.baudio {margin:5px;}
.baudio .baudio_table{display: inline;}
.baudio .bn{margin:10px;}
.baudio td{text-align:center;}
.baudio .blabel{margin-top:50px;font-size: 70%;	color: #636363;}

.scale {font-size: 100%;}
.scale td { text-align: left; padding:0;}
.scale label { display:block;}
.scale .c { text-align: center;}
section {
	margin-bottom:15px;
	padding: 10px 10px;
	font-family: Verdana, Geneva, sans-serif;
	color:#333333;
	font-size:0.9em;
}
fieldset { padding: 10px; background:#fbfbfb; border-radius:5px; margin-bottom:5px; }
</style>

<script type="text/javascript">

/*
General configuration file:
  - cookieName: change it for each study, it will be used to monitor if the user has taken training, setup sections, and
 how many assignments they submitted to expose limits.
 - qualificationCookieName: name of cookie that shows the status of qualification section.
 - qualificationValidFor: how long the qualification cookie stay in minutes (43200 : 1 month)
 - forceRetrainingInHours: every X hours force the user to take part in training (recommendation: 1hour)
 - showSetupEveryMinutes: show the setup section every X minutes (recommendation: 15 minutes)
 - questionUrls: URLs to clips to be appeared in the Rating section. Either hard-coded or placeholders.
 - trainingUrls: URLs to clips to be appeared in the Training section. Either hard-coded or placeholders.
 - knownQuestionInTrainingUrl: Training may contain a question with known answer which worker will be forced to give the
 correct answer to.
 - knownQuestionInTrainingAns: the answer that should be selected by worker
 - knownQuestionUrl: the rating section may contain a question with known answer. It will be used in combination of the
 Assignment Review Policy.
 - knownQuestionAns: the answer that we expect from worker
 - randomizeTrainingQuestions: boolean whether the questions in the training section should be randomized on loading time.
 - randomizeRatingQuestions: boolean whether the questions in the rating section should be randomized on loading time.
 - allowedMaxHITsInProject: How many HITs each worker is allowed to answer in this project
 - allowedMaxContinuesSessionDurationInMinutes: how log is the maximum continue session. A break of 10min will be forced

*/
var config ={
	cookieName:"{{cfg.cookie_name}}",
	qualificationCookieName:"{{cfg.qual_cookie_name}}",
	qualificationValidFor:43200,
    forceRetrainingInHours:1,
    showSetupEveryMinutes:30,
    debug:"true",
    questionUrls: {{cfg.rating_urls}},
    trainingUrls: {{cfg.training_urls}},

    knownQuestionInTrainingUrl:"{{cfg.training_trap_urls}}",
    knownQuestionInTrainingAns: "{{cfg.training_trap_ans}}",
    knownQuestionUrl:"${TP}",
    knownQuestionAns: "${TP_ANS}",
    goldClipURL:"${gold_clips}",
    goldClipAns:"${gold_clips_ans}",
    randomizeTrainingQuestions:"true",
    randomizeRatingQuestions:"true",
    allowedMaxHITsInProject:{{cfg.allowed_max_hit_in_project}},
	allowedMaxContinuesSessionDurationInMinutes:45,
	qualification:{
		mother_tongue: ["english","en"],
		ld_in: ["in-ear", "over-ear"],
		working_area: "N",
		hearing: "normal",
 		num1: "289",
        num2: "246",
        num3: "626",
        num4: "802",
        num5: "913"
	}
}

// if performing of this assignment is already counted
var hitCounterIncreased = false;
// record the errors happened in the page
var generalErrorLog= "";

const Hide_HIT_REASON = Object.freeze({"MAX_ACHIVED":1, "QUALIFICATON":2})
/*
Initializing the page: generate and hide sections depending to the cookies value
*/
$(function() {
	try{
		// disable logs if not debug
		if (!JSON.parse(config['debug'])){
			console.log = function() {};
		}
		loadTextPlaceHolders();
		generate_training_section();
		generate_rating_section();
		avoidAnsweringBeforeListeningThrough();
		cookie_debug_status="";
		// given cookie availability disable the qualification
		qual_passed= readCookie(config['qualificationCookieName']);
		console.log(qual_passed);

		if (qual_passed!==null && qual_passed=="true"){
			$('.qualificationFieldset').prop("disabled", true);
			$("#qualification").hide();
			$("#qualification :input").removeAttr("required");
			cookie_debug_status=cookie_debug_status+"ACR_LISTENER Exist*";
		}
		// given cookie availability disable the training
		if (readCookie(config['cookieName']+"_training")){
			$('.trainingFieldset').prop("disabled", true);
			$("#training").hide();
			$("#training :input").removeAttr("required");
			$('#instruction').collapse()
			cookie_debug_status=cookie_debug_status+"Train Exist*";
		}
		// given cookie availability disable the setup
		if (readCookie(config['cookieName']+"_setup")){
			$('.setupFieldset').prop("disabled", true);
			$("#setup").hide();
			$("#setup :input").removeAttr("required");
			cookie_debug_status=cookie_debug_status+"Setup Exist*";
		}

		hit_num = readCookie(config['cookieName']+"_counter");
		howManyHITsAnswered =0;
		if (hit_num != null ){
			howManyHITsAnswered= Number(hit_num);
			if (howManyHITsAnswered >= config['allowedMaxHITsInProject']){
				disableTheHIT(Hide_HIT_REASON.MAX_ACHIVED);
			}
		}
		if ((qual_passed!==null) && (qual_passed=="false")){
			disableTheHIT(Hide_HIT_REASON.QUALIFICATON);
		}

		hitCounterIncreased = false;
		cookie_debug_status=cookie_debug_status+"Counter:"+howManyHITsAnswered+"*";
		addBrowserInfo(cookie_debug_status);


		// for qualification section
		initializeQualification();
		initializeActivePageMonitoring();
	}catch(err){
		console.error(err);
		recordError(err.name,err.message);

	}
});

var overAllHiddenTime = 0;
var startHiddenDate = null;
var sessionId = null;
var sessionIdVariableName=null;
/**
	monitor and record the status of page including being focus, and active time

**/
function initializeActivePageMonitoring(){
	sessionId = Math.random().toString(36).substr(2, 9);
	sessionIdVariableName = config.qualificationCookieName +"_sid";
	createCookie(sessionIdVariableName,sessionId,70);

	document.addEventListener("visibilitychange", function() {
		var isHidden = document.hidden;
		if (isHidden){
			startHiddenDate = new Date();
		}else{
			//get back the focus
			stopHiddenDate = new Date();
			diff = stopHiddenDate -startHiddenDate;
			overAllHiddenTime = overAllHiddenTime + diff;
			$('#time_page_hidden_sec').val(overAllHiddenTime/1000);
		}
		console.log( "document_hidden: "+ document.hidden + "time: "+overAllHiddenTime);

	});
}

/**
	check if there is any parallel session available.
**/
function isAnyParallelSession(){
	hit_num = readCookie(sessionIdVariableName);
	if (hit_num != sessionId){
		$('#any_parallel_session').val("true");
		console.log("parallel session.")
		return true;
	}
	return false;

}

/**
 central method to record errors
**/
function recordError(name, message){
	generalErrorLog =generalErrorLog + " Error "+name+": "+message+";%0D%0A"
	$('#errors').val(generalErrorLog);
	$("#errorEmail").attr("href","mailto:ic3ai@outlook.com?subject=Error on HIT Load&body="+generalErrorLog);
	$("#errorSection").show();
}

/*
	Initialize the qualification section
*/
var qualification_ans= new Set();
function initializeQualification(){
	randomizeHearingtestItems();
    makeCheckboxBeRequired();
    forceNoSpaceInInput();
    $("#qualification :input").on('change', isQualificationDone);
}
/*
	check if the qualification all answered
*/
function isQualificationDone(){
	qualification_ans.add(this.name);
	console.log("check if the qualification is done"+this.name+","+qualification_ans.size);
	validateQualificationAnswer();
	if (qualification_ans.size==13)
		validateQualificationAnswer();
}

/*
	check the qualification passed
*/
function validateQualificationAnswer(){
	m_tongue = $("input[name='3_mother_tongue']").val().toLowerCase().trim();
	m_tongue_check= config.qualification.mother_tongue.includes(m_tongue)

	// check listening devices
	var listening_device = [];
	$.each($("input[name='4_ld']:checked"), function(){
		listening_device.push($(this).val());
	});
	device_check=false;
	for (var i = 0; i < listening_device.length; i++) {
		device_check = device_check || config.qualification.ld_in.includes(listening_device[i]);
	}
	working_area_checked= $("input[name='7_working_area']:checked").val() =="N"
	hearing_self_report_check=$("input[name='8_hearing']:checked").val() == "normal"
	count_correct_ht=0;
	if ($("input[name='num1']").val().trim()==config.qualification.num1)
		count_correct_ht ++;
	if ($("input[name='num2']").val().trim()==config.qualification.num2)
		count_correct_ht ++;
	if ($("input[name='num3']").val().trim()==config.qualification.num3)
		count_correct_ht ++;
	if ($("input[name='num4']").val().trim()==config.qualification.num4)
		count_correct_ht ++;
	if ($("input[name='num5']").val().trim()==config.qualification.num5)
		count_correct_ht ++;
	console.log("count_correct_ht:"+count_correct_ht);
	passed=  m_tongue_check && device_check && working_area_checked &&  hearing_self_report_check &&
		count_correct_ht>= 3;
	console.log(passed);
	// add a qualification for 'qualificationValidFor' minutes
	createCookie(config.qualificationCookieName,passed,config.qualificationValidFor);
}

/*
	randomize clips in the hearing test
*/
function randomizeHearingtestItems(){
    var cards = $(".rnd");
	for(var i = 0; i < cards.length; i++){
		var target = Math.floor(Math.random() * cards.length -1) + 1;
		var target2 = Math.floor(Math.random() * cards.length -1) +1;
		cards.eq(target).before(cards.eq(target2));
    }
}
/*
	Make a checkbox group to be required
*/
function makeCheckboxBeRequired(){
    var requiredCheckboxes = $('.4_lds :checkbox[required]');
    requiredCheckboxes.change(function(){
        if(requiredCheckboxes.is(':checked')) {
            requiredCheckboxes.removeAttr('required');
        } else {
            requiredCheckboxes.attr('required', 'required');
        }
    });
}
/*
	Avoid space in text field
*/
function forceNoSpaceInInput(){
    $(".nospace").on({
          keydown: function(e) {
            if (e.which === 32)
              return false;
          },
          change: function() {
            this.value = this.value.replace(/\s/g, "");
          }
        });
}

/*
Change placeholders inside text with values from config file.
*/
function loadTextPlaceHolders(){
	// update the instruction
	$('.max_allowed_hits').html(config['allowedMaxHITsInProject']);
	$('.setup_time').html(config['showSetupEveryMinutes']);
	$('.training_time').html(config['forceRetrainingInHours']);

}

/*
Store the following information in hidden input field which will be added to answerc.sv by AMT
userAgent, cookieEnabled, appVersion, platform, language, status of 3 cookies.
*/
function addBrowserInfo(debug){
	info="U_A:"+navigator.userAgent+";"+
		"CookieEnabled:"+navigator.cookieEnabled+";"+
		"AppV:"+navigator.appVersion+";"+
		"Platform:"+navigator.platform+";"+
		"LN:"+navigator.language+";"+
		"cookie_debug:"+debug+";";

	$('#browser_info').val(info);
	console.log(info);

}
//--------------- Utilities -----------------

/*
	Utility function to format strings
*/
String.prototype.format = String.prototype.f = function() {
    var s = this,
        i = arguments.length;
    while (i--) {
        s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
    }
    return s;
};

/*
	Utility: convert seconds to MM:SS
*/
String.prototype.toMMSS = function () {
    var sec_num = parseInt(this, 10); // don't forget the second param
    var minutes   = Math.floor(sec_num / 60);
    var seconds = sec_num - (minutes * 60);
    if (minutes < 10) {minutes = "0"+minutes;}
    if (seconds < 10) {seconds = "0"+seconds;}
    return minutes+':'+seconds;
}

/*
	Disable the HIS and show a proper message.
	- used when the maximum number of HITs in project is reached
*/
function disableTheHIT(c){
	$("#qualification").hide();
	$("#training").hide();
	$("#setup").hide();
	$("#rating_section").hide();
	$("#Survey").hide();
	$("#thanks").hide();
	$("#device_check_section").hide();

	if (c == Hide_HIT_REASON.MAX_ACHIVED)
		$("#max_allowed_HITs_reached").show();
	if (c == Hide_HIT_REASON.QUALIFICATON)
		$("#qualification_rejected").show();
}

/*
	Add a cookies with corresponding values
*/
function createCookie(name, value, minutes) {
    var expires;
    if (minutes) {
        var date = new Date();
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        expires = date.toGMTString();
    } else {
        expires = "";
    }

    let st =value +";"+ expires ;
    console.log(st);
    localStorage.setItem(name, st);
}

function createCookieOld(name, value, minutes) {
    var expires;
    if (minutes) {
        var date = new Date();
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        expires = "expires=" + date.toGMTString();
    } else {
        expires = "";
    }

    let st = name + "=" + value +";"+ expires + ";path=/";
    console.log(st);
    //document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + expires + "; path=/";
    document.cookie = st;
}

/*
	Update the cookie which counts the number of Assignments performed by user. Increase it by "updateBy" value.
*/
function updateCounterCookie(name, updateBy){
	expiry_in_a_month= 30*24*60
	c = readCookie(name);
	if (c==null){
		createCookie(name, 1, expiry_in_a_month);
		return 1;
	}else{
	 	console.log(c);
	 	createCookie(name, Number(c)+updateBy, expiry_in_a_month);
	}
	return Number(c)+updateBy;
}

/*
	Return the value of cookie, or null
*/
function readCookie(name) {
	var storedValue = localStorage.getItem(name);
	if (storedValue){
		let infos = storedValue.toString().split(';');
		let value = infos[0];
		let validUntil = new Date(infos[1]);
		let today = new Date();
		if (today<=  validUntil)
			return value;
		else{
			localStorage.removeItem(name);
			return null;
		}
	}else
		return null;
}

function readCookieOld(name) {
    var nameEQ = name + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var cookies = decodedCookie.split(';');
    for (var i = 0; i < cookies.length; i++) {
        var c = cookies[i];
        while (c.charAt(0) == ' '){
            c = c.substring(1);
        }
        if (c.indexOf(nameEQ) === 0)
            return c.substring(nameEQ.length, c.length);
    }
    return null;
}


/*
	Callback when "Next" in Rating section is clicked.
*/
function showNextQuestionInRatingSection(){
	var count = $("#nav-tab-ul li").length;
	id=$("#nav-tab-ul li.active").index();
	if (id+2==count){
		$('#next-rating').addClass('disabled');
	}
	id=id+2;
	$('#nav-tab-ul li:nth-child('+id+') a').tab('show');

}

/*
	Callback when "Previous" in Rating section is clicked.
*/
function showPreviousQuestionInRatingSection(){
	id=$("#nav-tab-ul li.active").index();
	id=id;
	$('#nav-tab-ul li:nth-child('+id+') a').tab('show');
	var count = $("#nav-tab-ul li").length;
	if (id+1<=count)
		$('#next-rating').removeClass('disabled');
}

/*
	Callback when "Next" in Training section is clicked.
*/
function showNextQuestionInTrainingSection(){
	var count = $("#trainingTabs li").length;
	id=$("#trainingTabs li.active").index();
	if (id+1!=count){
		id=id+2;
		$('#trainingTabs li:nth-child('+id+') a').tab('show');
	}else{
		// last next is called
		setTimeout(function (){
			window.location.hash="navNextPre";
		},  50);
	}
}

/*
	Callback when "Previous" in Training section is clicked.
*/
function showPreviousQuestionInTrainingSection(){
	id=$("#trainingTabs li.active").index();
	id=id;
	$('#trainingTabs li:nth-child('+id+') a').tab('show');
}


var trainingStimulusPlayed;

/*
  If all training clips played until the end, add a cookie expiring after
  config.forceRetrainingInHours
*/
function playedAudioTraining(id){
	// parallel session check
	isAnyParallelSession();
	$('input[name="'+id+'"]').off('change');
	trainingQuestionNumber= id.substring(1);
	eval("trainingStimulusPlayed["+trainingQuestionNumber+"-1]=1;");
	console.log(trainingStimulusPlayed.reduce(getSum, 0))
	if (trainingStimulusPlayed.reduce(getSum, 0) ==  trainingStimulusPlayed.length){
		createCookie(config['cookieName']+"_training","un_important",config['forceRetrainingInHours']*60);
	}
	if ($('span[id="'+id+'"]').attr("data-src") == config['knownQuestionInTrainingUrl']){
		element = $('input[name="'+id+'"]');
		element.unbind();
		element.on('change', onValueChangeForTpQuestionInTraining);
	}
}

// help to calc the sum of elements in an array
function getSum(total, num) {
  return total + num;
}

//---------------- baudio.js -----------------
// All functions needed for custom audio playback
var audioElements=[];
function clickManager(event) {
	ae=event.data.ae;
	var id=event.data.id;
	if (ae.paused) {
		pauseAll();
		playAudio(ae);
	} else {
		pauseAudio(ae);
	}
};

function playAudio(audio){
	audio.play();
	var idT=audio.id;
	var id=idT.substring(6,idT.length);
	console.log(id);
	$("#baudio_s_"+id).removeClass("glyphicon-repeat");
	$("#baudio_s_"+id).removeClass("glyphicon-play");
	$("#baudio_s_"+id).addClass("glyphicon-pause");
	$("#baudio_"+id).addClass("btn-primary");
	$("#audio_n_play_"+id).val(parseInt($("#audio_n_play_"+id).val())+1);
}

function pauseAudio(audio){
	audio.pause();
	var idT=audio.id;
	var id=idT.substring(6,idT.length);
	$("#baudio_s_"+id).removeClass("glyphicon-pause");
	$("#baudio_"+id).removeClass("btn-primary");
	$("#baudio_s_"+id).addClass("glyphicon-play");
}

function pauseAll(){
	for (i = 0; i < audioElements.length; i++) {
		if (!audioElements[i].paused){
			pauseAudio(audioElements[i]);
		}
	}
}

function canPlay(event){
	var ae=this;
	var idText =this.id;
	var id=idText.substring(6,idText.length);
	$("#baudio_l_d_"+id).text(" / " + (ae.duration).toString().toMMSS());
	$("#baudio_"+id).removeClass("disabled");
}

function timeUpdate(){
	var ae=this;
	var idText =this.id;
	var id=idText.substring(6,idText.length);
	$("#baudio_l_c_"+id).text(ae.currentTime.toString().toMMSS());
}

function isended(){
	var ae=this;
	var idText =this.id;
	var id=idText.substring(6,idText.length);

	$("#baudio_s_"+id).removeClass("glyphicon-pause");
	$("#baudio_"+id).removeClass("btn-primary");
	$("#baudio_s_"+id).addClass("glyphicon-repeat");
	$("#audio_n_finish_"+id).val(parseInt($("#audio_n_finish_"+id).val())+1);
	if ($("#"+id).attr('data-onfinished')){
		window[$("#"+id).attr('data-onfinished')](id);
	}
}

// loading all baudio elements in the page
$(function() {
    $( ".baudio" ).each(function(){
		titleTextTemplate='<tr><td>{1}</td></tr>';
		insert='';
		title='';
		a='<audio id="audio_{0}" preload="true"><source src="{1}" type="audio/wav"> </audio>'+
		'<input type="hidden" id="audio_n_play_{0}" name="audio_n_play_{0}" value="0">'+
		'<input type="hidden" id="audio_n_finish_{0}" name="audio_n_finish_{0}" value="0">';
		if ($(this).attr('title')){
			insert=titleTextTemplate;
			title=$(this).attr('title');
		}

		t='<table class="baudio_table" border="0">'+insert+' <tr><td><button id="baudio_{0}" type="button" class="btn bn disabled"><span id ="baudio_s_{0}" class="glyphicon glyphicon-play"></span></button></td></tr><tr><td><span id="baudio_l_c_{0}" class="blabel" >00:00</span><span id="baudio_l_d_{0}" class="blabel" > / 00:00</span></td></tr></table>';
		src=$(this).attr('data-src');
		id=$(this).attr('id');

		$(this).append(a.f(id,src));
		$(this).append(t.f(id,title));
		var audioElement = document.getElementById("audio_"+id);
		//save for later
		audioElements.push(audioElement);
		$( "#baudio_"+id ).click({ae: audioElement, id: id},clickManager);
		$( "#baudio_"+id ).disabled=false;
		audioElement.addEventListener("canplay",canPlay.bind(audioElement),false);
		audioElement.addEventListener("timeupdate",timeUpdate.bind(audioElement),false);
		audioElement.addEventListener("ended",isended.bind(audioElement),false);
	});

	$("source").on("error", function (e) {
        console.log("Error at audio tag level!"+e.target.src);
        problematic_urls=problematic_urls+"<li>"+e.target.src+"</li>";
        //$("#error_details").html(problematic_urls);
        recordError("on loading audio clips",e.target.src);
        //$("#error_loading_files").show();
    });
});
var problematic_urls="";
/*
	Called when the scale item is clicked
*/
function alertForbiddenChange(){
	alert('You should listen until the end.');
	$(this).prop('checked', false);
}

/*
	Users should not be able to vot before listening the audio clips until the end.
*/
function avoidAnsweringBeforeListeningThrough(){
	var i;
	// Training section
	for (i = 0; i < config['trainingUrls'].length; i++) {
		$('input[name="t{0}"]'.f(i+1)).on('change', alertForbiddenChange);
	}
	// Rating section
	for (i = 0; i < config['questionUrls'].length; i++) {
		$('input[name="q{0}"]'.f(i+1)).on('change', alertForbiddenChange);
	}
}

/*
	Listener on value change for the Gold question.
	if the answer is correct, change the value of gq_check to 0.
*/
function onValueChangeForGoldQuestion(){
	let ans = $( this ).val()
	let expectedVal = parseInt(config['goldClipAns'])
	if ( expectedVal -1 <=ans && ans <= expectedVal +1 )
		$('#gq_check').val(0);
	else
		$('#gq_check').val(-1);
	console.log($('#gq_check').val())
}

/*
	Listener on value change for the trapping question.
	if the answer is correct, change the value of tp_check to 0.
*/
function onValueChangeForTpQuestion(){
	if ($( this ).val()  == parseInt(config['knownQuestionAns']))
		$('#tp_check').val(0);
	else
		$('#tp_check').val(-1);
	//console.log("gc_check"+$('#tp_check').val())
}

/*
	Listener on value change for the trapping question in training.
	if the answer is wrong, show a message.
*/
function onValueChangeForTpQuestionInTraining(){
	if ($( this ).val()  != config['knownQuestionInTrainingAns']){
		alert('Error: In case you hear an interruption message, please follow the instruction given in the message.');
		$(this).prop('checked', false);
	}

}

/*
	Called when the audio in rating section by the given id is completely played.
	Now user can rate the quality.
*/
function playedAudioQ(id){
	// parallel session check
	isAnyParallelSession();
	// check if it was the trapping question
	if ($('span[id="'+id+'"]').attr("data-src") == config['knownQuestionUrl']){
		element = $('input[name="'+id+'"]');
		element.unbind();
		element.on('change', onValueChangeForTpQuestion);
	}else if ($('span[id="'+id+'"]').attr("data-src") == config['goldClipURL']){
		element = $('input[name="'+id+'"]');
		element.unbind();
		element.on('change', onValueChangeForGoldQuestion);
	}else{
		$('input[name="'+id+'"]').off('change');
		// check if already this HIT is counted
		if (!hitCounterIncreased){
			updateCounterCookie(config['cookieName']+"_counter",1);
			hitCounterIncreased=true
		}
	}
}

/*
	Called when user answers to one question from setup
	(i.e. q2. math question). Here the cookie will be added/updated
*/
function userAnsweringToSetupQuestions(){
	createCookie(config['cookieName']+"_setup","un_important",config['showSetupEveryMinutes']);
	$('input[name="math"]').off('change');
}

</script>

<script type="text/javascript">

/*
	functions responsible to headset check
*/
function isHeadsetOn(webrtc_raw){
	keywords= ["headphone",  "headset","airpod", "usb audio device"]
	for (var i = 0; i < keywords.length; i++) {
		if (webrtc_raw.includes(keywords[i]))
			return true;
	}
	return false;
}

const constraints = {
  	audio: true,
	video:false
};

/*
	Async function to check the list of audio devices when the user allowed
*/
const startHeadsetCheck = async function() {
	$('#status').html("waiting for allowance...")
    await navigator.mediaDevices.getUserMedia(constraints);

    navigator.mediaDevices.enumerateDevices()
    .then(devices => {
        var device_list= "";
        for (var i=0;i<devices.length;i++){
        	if (devices[i].kind.startsWith('audio')){
    			device_list = device_list+ devices[i].kind + ":" +devices[i].label.toLowerCase() +"+";
    		}
        }
        headsetDetected=isHeadsetOn(device_list);
        $( "#webrtc_raw" ).val(device_list);
        $( "#use_headset" ).val(headsetDetected);
		$( "#status" ).html("Done. Please continue.");
  });
}

//function startMeasure(){
// 	startHeadsetCheck();
//}
</script>

<script type="text/javascript">

/*
	shuffle function for randomization of items -->
*/
function shuffle(a) {
	var j, x, i;
	for (i = a.length - 1; i > 0; i--) {
		j = Math.floor(Math.random() * (i + 1));
		x = a[i];
		a[i] = a[j];
		a[j] = x;
	}
	return a;
}

/*
	Generate the training section
*/
function generate_training_section(){
	acr_nav_tab = '<li class="nav-item {1}"><a class="nav-link " data-toggle="tab"  href="#T{0}-panel" id="T{0}-tab " role="tab" aria-controls="T{0}" {2}>Q. {0}</a></li>';
	acr_tab ='<div class="tab-pane fade {2}" id="T{0}-panel" role="tabpanel" aria-labelledby="T{0}-tab"><p></p><div class="row">	<div class="col-sm-3"></div>	<div class="col-sm-6">		<p style="margin-top:10px;">{0}. Wie würden Sie die <b>Gesamtqualität</b> des folgenden Sprach-Sample bewerten? </p><p align="center"> <span class="baudio" id="t{0}" data-onfinished="playedAudioTraining" data-src="{1}" >&nbsp;</span> </p><fieldset id="fieldset_t{0}" class="trainingFieldset" title=""><table class="table md scale" cellspacing="0" cellpadding="0">			<thead><tr><th >Sprachqualität</th><th class="c" >Bewertung</th></tr>			</thead>			<tbody><tr><td><div class="radio" ><label ><input type="radio" name="t{0}" value="5">Exzellent</label></div></td><td class="c">5</td></tr><tr><td><div class="radio" ><label ><input type="radio" name="t{0}" value="4">Gut</label></div></td><td class="c">4</td></tr><tr><td><div class="radio" ><label ><input type="radio" name="t{0}" value="3">Akzeptabel</label></div></td><td class="c">3</td></tr><tr><td><div class="radio" ><label ><input type="radio" name="t{0}" value="2">Schlecht</label></div></td><td class="c">2</td></tr><tr><td><div class="radio" ><label ><input type="radio" name="t{0}" value="1"required="">Sehr Schlecht</label></div></td><td class="c">1</td></tr>	   </tbody></table>		</fieldset><p></p> </div> 	<div class="col-sm-3"></div></div> <p></p> </div>';
	// this will show which url was shown by in which question as their orther will be randomized
	input_template= '<input id="T{0}_URL" name="T{0}_URL" type="hidden" value="{1}" />';

    if (JSON.parse(config['randomizeTrainingQuestions']))
		urls = shuffle(config['trainingUrls']);
	else
		urls = config['trainingUrls'];

	var i;
	for (i = 0; i < urls.length; i++) {
		if (i==0){
			$('#trainingTabs').append(acr_nav_tab.f(i+1,'active', 'ria-selected="true"'));
			$('#nav-tabContent').append(acr_tab.f(i+1, urls[i],'in active'));
		}else{
			$('#trainingTabs').append(acr_nav_tab.f(i+1,'',''));
			$('#nav-tabContent').append(acr_tab.f(i+1, urls[i],''));
		}
		$('#av-tabContent').append(input_template.f(i+1, urls[i]));
	}
	$('.question_number_training').html(urls.length);
	trainingStimulusPlayed = new Array(urls.length).fill(0);
}

/*
	Generate rating section
*/
function generate_rating_section(){
	acr_nav_tab = '<li class="nav-item {1}"><a class="nav-link" data-toggle="tab" href="#Q{0}-panel" id="Q{0}-tab" role="tab" aria-controls="Q{0}" {2}>Q. {0}</a></li>';
	acr_tab ='<div class="tab-pane fade {2}" id="Q{0}-panel" role="tabpanel" aria-labelledby="q{0}-tab"> <p></p> <div class="row"> <div class="col-sm-3"></div> <div class="col-sm-6"> <p style="margin-top:10px;">{0}. Wie würden Sie die <b>Gesamtqualität</b> des folgenden Sprach-Sample bewerten? </p> <p align="center"> <span class="baudio" id="q{0}" data-onfinished="playedAudioQ" data-src="{1}" >&nbsp;</span> </p> <fieldset id="fieldset_q{0}" title=""> <table class="table md scale" cellspacing="0" cellpadding="0"> <thead> <tr><th >Sprachqualität</th><th class="c" >Bewertung</th></tr> </thead> <tbody> <tr><td><div class="radio" ><label ><input type="radio" name="q{0}" value="5">Exzellent</label></div></td><td class="c">5</td></tr> <tr><td><div class="radio" ><label ><input type="radio" name="q{0}" value="4">Gut</label></div></td><td class="c">4</td></tr> <tr><td><div class="radio" ><label ><input type="radio" name="q{0}" value="3">Akzeptabel</label></div></td><td class="c">3</td></tr> <tr><td><div class="radio" ><label ><input type="radio" name="q{0}" value="2">Schlecht</label></div></td><td class="c">2</td></tr> <tr><td><div class="radio" ><label ><input type="radio" name="q{0}" value="1"required="">Sehr schlecht</label></div></td><td class="c">1</td></tr> </tbody> </table> </fieldset> <p></p> </div> <div class="col-sm-3"></div> </div> <p></p> </div>';
	// this will show which url was shown by in which question as their orther will be randomized
	input_template= '<input id="Q{0}_URL" name="Q{0}_URL" type="hidden" value="{1}" />';
	if (JSON.parse(config['randomizeRatingQuestions'])){
		urls = shuffle(config['questionUrls']);
	}else{
		urls = config['questionUrls'];
	}

	var i;
	for (i = 0; i < urls.length; i++) {
		if (i==0){
			$('#nav-tab-ul').append(acr_nav_tab.f(i+1,'active', 'ria-selected="true"'));
			$('#nav-tabContent-rating').append(acr_tab.f(i+1, urls[i],'in active'));
		}else{
			$('#nav-tab-ul').append(acr_nav_tab.f(i+1,'',''));
			$('#nav-tabContent-rating').append(acr_tab.f(i+1, urls[i],''));
		}
		$('#nav-tabContent-rating').append(input_template.f(i+1,urls[i]));
	}
	$('.question_number').html(urls.length);

}
</script>

<!--    Error -->
<section class="container" id="errorSection" hidden>
	<div class="alert alert-danger" role="alert" >
		<h5>Error</h5>
		<p>One or more errors are detected during loading this HIT. Please use the following link to send the error to us: <a class="email"  id="errorEmail"title="Email in HIT" href="">Email</a>.</p>
		<p><b> Meanwhile, please return this HIT and try another one</b>.</p>
	</div>
</section>

<!-- Anleitung -->
<section class="container" id="Survey">
	<div class="panel panel-primary">
		<div class="panel-heading">
			<h3 class="panel-title">
				<a data-target="#instruction" data-toggle="collapse" >Anleitung für die Bewertung der Sprachqualität</a>
			</h3>
		</div>
		<div  class="panel-collapse collapse in" id="instruction">
			  <div class="panel-body" >
			  <b>Einführung</b>


				<img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/process_3.png" alt="scale" class="center" style='width: 60%' >

				  <p>Herzlich Willkommen! Sie werden an einem Experiment zur Ermittlung der Sprachqualität teilnehmen! Dieser HIT hat insgesamt zwei + zwei (hin und wieder) Sektionen:</p>
				<ul>
					<li><b>Qualifikation (nur einmal):</b> Prüfen Sie ob Sie berechtigt sind an diesem HIT teilzunehmen</li>
					<li><b>Setup (alle <b class="setup_time"> 0</b> Minuten):</b> Konfigurieren Sie Ihr System und validieren Sie es mit 6 Fragen</li>
					<li><b>Training (alle <b class="training_time"> 0 </b> Stunden):</b> <b class="question_number_training"> 0 </b> Fragen, genau so wie das Rating, aber nur einmal am Tag</li>
					<li><b>Rating:</b> Hören Sie sich <b class="question_number"> 0 </b> Audio-Dateien an und <b>beurteilen Sie die Sprachqualität</b></li>
				</ul>
				<p>Beachten Sie, dass nicht alle Teile der Audio-Dateien auf Deutsch sind.</p>
				<p>Folgen Sie den unten genannten Regeln, andererseits sind Ihre Antworten ungültig.</p>
				<p><b>Regeln:</b></p>
				<ul>
					<li>Sie müssen <b>Kopfhörer</b>, und nicht einen Lautsprecher verwenden: Andererseits werden Ihre Antworten abgelehnt</li>
					<li>Sie müssen die Aufgaben in einer<b> ruhigen Umgebung</b> absolvieren</li>
					<li>Ändern Sie nicht das Volumen, nachdem Sie dieses im Setup festgelegt haben.</li>
				</ul>

				<p><b>Bezahlung:</b></p>
				<p>Die Resultate dieses Experiments<b> sind sehr wichtig für uns und andere Wissenschaftler</b>, welche in diesem Bereich arbeiten. Wir verwenden Methoden, um die Konsistenz der abgegebenen Antworten zu analysieren. Wir verwenden diese Methoden, um die abgegebenen Assignments auf ihre Qualität zu überprüfen.</p>
				<p>Für dieses Experiment gibt es eine Basis-Bezahlung von <b>${{cfg.hit_base_payment}}/HIT</b> für jeden akzeptierten HIT. Insgesamt sind <b class="max_allowed_hits">0 </b> verschiedene HITs verfügbar. Sie werden einen Bonus :</p>

				<ul>
				  <li>${{cfg.quantity_bonus}}/HIT (in Höhe von insgesamt <b>${{cfg.sum_quantity}}/HIT</b>) , wenn Sie  <b> mehr als  {{cfg.quantity_hits_more_than}} HITs erfolgreich bearbeiten</b> oder</li>
				  <li>${{cfg.quality_bonus}}/HIT (in Höhe von insgesamt <b>${{cfg.sum_quality }}/HIT</b>) ,  wenn Sie  <b> mehr als  {{cfg.quantity_hits_more_than}} HITs</b> <u>und</u> in den <b> Top {{cfg.quality_top_percentage}}% der Vergleichsgruppe sind</b>.</li>
				</ul>

				<p>Der Bonus wird innerhalb von 7 Tagen ausgezahlt.</p>
				  <b>Sie können bis zu <b class="max_allowed_hits"> 0 </b> HITs aus dieser Gruppe bearbeiten. Wenn Sie mehr HITs bearbeiten, wird der <u>Rest abgelehnt.</u></b>
			</div>
		</div>

	</div>
</section>


<!-- Qualifikation -->
<section class="container" id="qualification">

<div class="row col-xs-12 col-md-12">
<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">
		<a data-toggle="collapse" href="#collapse1">Qualifikation - Nur einmal</a>
	</h3>
  </div>
  <div id="collapse1" class="panel-collapse collapse in">
	  <div class="panel-body">

		<fieldset class="qualificationFieldset"><label>1.&nbsp;Was ist ihr Geschlecht?</label>
				<div class="radio">
				  <label><input type="radio" name="1_gender" value="M" required="">Männlich</label>
				</div>
				<div class="radio">
				  <label><input type="radio" name="1_gender" value="W">Weiblich</label>
				</div>
				<div class="radio disabled">
				  <label><input type="radio" name="1_gender" value="O">Etwas anderes</label>
				</div>
		</fieldset>
		<fieldset class="qualificationFieldset"><label>2.&nbsp;In welchem Jahr wurden Sie geboren? </label>
				<div class="form-group">
				  <input type="text" class="form-control" name="2_birth_year" required="">
				</div>
		</fieldset>

		<fieldset class="qualificationFieldset"><label>3.&nbsp;Was ist Ihre Muttersprache </label>
				<div class="form-group">
				  <input type="text" class="form-control" name="3_mother_tongue" required="">
				</div>
		</fieldset>


		<fieldset class="qualificationFieldset"><label>4.&nbsp; Welche Arten von Audio-Geräten stehen Ihnen für dieses Experiment zur Verfügung (wählen Sie alle Zutreffenden aus)?</label>

			<div class="table-responsive 4_lds">
			  <table class="table" border="0" cellpadding="0" cellspacing="0" >
				<tbody>
					<tr>
						<td style="width:25%"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/inear.png" alt="in-ear headphones" width="100px"> </td>
						<td style="width:25%"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/overear.png" alt="Over-the-ear headphones" width="100px"> </td>
						<td style="width:25%"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/louadspeaker.png" alt="louadspeaker" width="100px"> </td>
						<td style="width:25%"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/inbuild.png" alt="inbuild speakers" width="100px"> </td>
					</tr>
					<tr>
						<td><div class="checkbox"><label><input type="checkbox" value="in-ear" name="4_ld" required>In-ear Kopfhörer</label></div></td>
						<td><div class="checkbox"><label><input type="checkbox" value="over-ear" name="4_ld" required>Over-the-ear Kopfhörer</label></div></td>
						<td><div class="checkbox"><label><input type="checkbox" value="ex-ls" name="4_ld" required>Externe Lautsprecher</label></div></td>
						<td><div class="checkbox"><label><input type="checkbox" value="ib-ls" name="4_ld" required>Eingebaute Lautsprecher</label></div></td>
					</tr>

				</tbody>
			  </table>
			</div>

		</fieldset>

		<fieldset class="qualificationFieldset">
				 <div class="form-group">
				  <label for="sel1">5.&nbsp;Wann war das letzte Mal <span title="Ein Produkt oder Medium beurteilen, z.B. Was ist die Gesamtqualität eines Videos "><u>, dass Sie an einem subjektiven Test teilgenommen haben</u></span>?</label>
				  <select class="form-control" id="sel1" name="5_last_subjective" required="">
					<option value="">Bitte wählen Sie aus</option>
					<option value="0d">Heute</option>
					<option value="3d">In den letzten 3 Tagen</option>
					<option value="7d">In der letzten Woche</option>
					<option value="30d">Im letzen Monat</option>
					<option value="nn">Noch nie</option>
				  </select>
				</div>
		</fieldset>

		<fieldset class="qualificationFieldset">
				 <div class="form-group">
				  <label for="sel2">6.	Wann war das letzte Mal <span title="Ein Audio auf seine Qualität beurteilen"><u>, dass Sie an einem Audio-Zuhör Test teilgenommen haben</u></span>?</label>
				  <select class="form-control" id="sel2" name="6_audio_test" required="">
					<option value="">Bitte wählen Sie aus</option>
					<option value="0d">Heute</option>
					<option value="3d">In den letzten 3 Tagen</option>
					<option value="7d">In der letzten Woche</option>
					<option value="30d">Im letzen Monat</option>
					<option value="nn">Noch nie</option>
				  </select>
				</div>
		</fieldset>

		<fieldset class="qualificationFieldset"><label>7.&nbsp;Waren Sie schon einmal direkt eingebunden in die Arbeit der Beurteilung der Performance von Telekommikations-Sytemen, oder verwandter Arbeit wie Speech-Coding?</label>
				<div class="radio">
				  <label><input type="radio" name="7_working_area" value="Y" required="">Ja</label>
				</div>
				<div class="radio">
				  <label><input type="radio" name="7_working_area" value="N">Nein</label>
				</div>
		</fieldset>

		<fieldset class="qualificationFieldset"><label>8.&nbsp; Ich glaube, dass ...</label>
				<div class="radio">
				  <label><input type="radio" name="8_hearing" value="normal" required="">ich eine normale Hörfähigkeit habe.</label>
				</div>
				<div class="radio">
				  <label><input type="radio" name="8_hearing" value="mid">ich Schwierigkeiten habe einem Gespräch zu folgen, besonders in lauten Umgebungen (mittlerer Hör-Verlust).</label>
				</div>
				<div class="radio">
				  <label><input type="radio" name="8_hearing" value="moderate">ich Schwierigkeiten habe einem Gespräch zu folgen, wenn ich meine Hörhilfen nicht verwende (moderater Hör-Verlust).</label>
				</div>
				<div class="radio">
				  <label><input type="radio" name="8_hearing" value="severe">ich mich auf das Lippenlesen verlasse, auch wenn ich Hörgerate verwende (ernsthafter Hör-Verlust). </label>
				</div>
		</fieldset>


		<div style="text-align: center;margin:30px;"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/attention.png" alt="attention"> </img> <b>Bitte setzen sie jetzt Ihre Kopfhörer auf.</b></div>

	   <fieldset class="qualificationFieldset"><label>9.&nbsp;Bitte stellen sie die Lautstärke auf ihrem Computer auf ein komfortables Level.</label>

			<p align="center"> <span class="baudio" id="volume" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/signal_level.wav" >&nbsp;</span> </p>

			<div class="alert alert-warning" role="alert">
			  <b>Achtung:</b> Achtung: Danach dürfen Sie das Volumen nicht mehr ändern. Andererseits werden ihre Antworten abgelehnt.
			</div>

		</fieldset>

		<fieldset class="qualificationFieldset"><label>10.&nbsp;In jedem der folgenden Tests hören Sie eine Kombination von 3 Ziffern (z.B. 1 5 3), welche mit Hintergrund-Geräuschen aufgenommen wurden. Bitte geben Sie die drei Nummern, welche Sie verstanden haben, in die untere Box ein. </label>


			<div class="row" style="margin: 30px;">
				<div class="col-xs-12 col-sm-4 col-md-2 col-lg-2">
					<div class="row" style="text-align:center;">
						<span class="baudio" id="n1" title="" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/sample_hearing_test/s0.wav" >&nbsp;</span>
					</div>
					<input type="text" name="num1" required="" class="nospace" autocomplete="off">
				</div>

				<div class="col-xs-12 col-sm-4 col-md-2 col-lg-2 rnd">
					<div class="row" style="text-align:center;">
						<span class="baudio" id="n2" title="" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/sample_hearing_test/s1.wav" >&nbsp;</span>
					</div>
					<input type="text" name="num2" required="" class="nospace" autocomplete="off">
				</div>
				<div class="col-xs-12 col-sm-4 col-md-2 col-lg-2 rnd">
					<div class="row"style="text-align:center;">
						<span class="baudio" id="n3" title="" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/sample_hearing_test/s2.wav" >&nbsp;</span>
					</div>
					<input type="text" name="num3" required="" class="nospace" autocomplete="off">
				</div>
				<div class="col-xs-12 col-sm-4 col-md-2 col-lg-2 rnd">
					<div class="row"style="text-align:center;">
						<span class="baudio" id="n4" title="" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/sample_hearing_test/s3.wav" >&nbsp;</span>
					</div>
					<input type="text" name="num4" required="" class="nospace" autocomplete="off">
				</div>
				<div class="col-xs-12 col-sm-4 col-md-2 col-lg-2 rnd">
					<div class="row" style="text-align:center;">
						<span class="baudio" id="n5" title="" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/sample_hearing_test/s4.wav" >&nbsp;</span>
					</div>
					<input type="text" name="num5" required="" class="nospace" autocomplete="off">
				</div>
			</div>

		</fieldset>
	  </div>
  </div>
</div>

</div>
</section>


<!-- Setup -->
<section class="container" id="setup">
<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">
		<a data-target="#setup_panel" data-toggle="collapse" >Setup (alle <b class="setup_time"> a </b> Minuten)</a>
	</h3>
  </div>
  <div  class="panel-collapse collapse in" id="setup_panel">
	  <div class="panel-body">

		  <div style="text-align: center;margin:30px;"> <img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/attention.png" alt="attention">  <b>Setzen Sie ihre Kopfhörer jetzt auf. Sie <u>müssen Kopfhörer tragen</u>. </b></div>

		<fieldset class="setupFieldset" ><label>1.&nbsp;Bitte stellen Sie die Lautstärke<b>auf ein komfortables Niveau</b>, sodass Sie das folgende Beispiel gut verstehen können.</label>

			<p align="center"> <span class="baudio" id="volume2" data-src="https://audiosamplesp808.blob.core.windows.net/p808-assets/clips/signal_level.wav" >&nbsp;</span> </p>

			<div class="alert alert-danger" role="alert">
			  <b>Achtung:</b> Falls Sie diesen Schritt auslassen, kann das die Antwort stark negativ beinflussen.
			</div>

			<div class="alert alert-warning" role="alert">
			  Achtung: Nachdem Sie das Level eingestellt haben, düften Sie nicht mehr das Volumen ändern. Andererseits wird ihre Antwort abgelehnt.
			</div>
		</fieldset>


		<fieldset  class="setupFieldset"><label>2.&nbsp; Bitte hören Sie sich folgende Audio-Datei an und geben Sie ihre Antwort auf die Frage ab: </label>

				<div align="center"> <span class="baudio" id="math1" data-src="${math}" >&nbsp;</span> </div>


		<div align="center">Result: &nbsp; <input id="Math" name="Math" required="" size="10" type="text" onchange="userAnsweringToSetupQuestions()"/> </div>

		</fieldset>

		<div class="alert alert-info" role="alert">Für die folgenden <b>vier Fragen,</b>, geben Sie bitte an, welches Audio-Sample eine bessere Qualität als das Andere ihrer Meinung nach hat.</div>


		<fieldset  class="setupFieldset"><label>3.&nbsp;Welches Audio-Sample hat eine bessere Qualität als das Andere? </label>

		<div class="row" style="margin-top:10px;">
				<div class="col-sm-4">
					<div align="right"> <span class="baudio" id="CMP1_A" title="Audio A" data-src="${CMP1_A}" >&nbsp;</span> </div>
				</div>
				<div class="col-sm-4"></div>
				<div class="col-sm-4">
					<div align="left"> <span class="baudio" id="CMP1_B" title="Audio B" data-src="${CMP1_B}" >&nbsp;</span> </div>
				</div>
		</div>

		<div class="row" >
				<div class="col-sm-4"></div>
				<div class="col-sm-5">
					<div class="radio"><label><input type="radio" name="cmp1" required="" value="a">Die Qualität von <b>Audio A</b> ist besser.</label></div>
					<div class="radio"><label><input type="radio" name="cmp1" required="" value="o">Es ist <b>kein Unterschied hörbar</b>.</label></div>
					<div class="radio"><label><input type="radio" name="cmp1" required="" value="b">Die Qualität von <b>Audio B</b> ist besser.</label></div>
				</div>
				<div class="col-sm-3"></div>
		</div>

		</fieldset>

		<fieldset  class="setupFieldset"><label>4.&nbsp;Welches Audio-Sample hat eine bessere Qualität als das Andere? </label>

		<div class="row" style="margin-top:10px;">
				<div class="col-sm-4">
					<div align="right"> <span class="baudio" id="CMP2_A" title="Audio A" data-src="${CMP2_A}" >&nbsp;</span> </div>
				</div>
				<div class="col-sm-4"></div>
				<div class="col-sm-4">
					<div align="left"> <span class="baudio" id="CMP2_B" title="Audio B" data-src="${CMP2_B}" >&nbsp;</span> </div>
				</div>
		</div>

		<div class="row" >
				<div class="col-sm-4"></div>
				<div class="col-sm-5">
					<div class="radio"><label><input type="radio" name="cmp2" required="" value="a">Die Qualität von <b>Audio A</b> ist besser.</label></div>
					<div class="radio"><label><input type="radio" name="cmp2" required="" value="o">Es ist <b>kein Unterschied hörbar</b>.</label></div>
					<div class="radio"><label><input type="radio" name="cmp2" required="" value="b">Die Qualität von <b>Audio B</b> ist besser.</label></div>
				</div>
				<div class="col-sm-3"></div>
		</div>

		</fieldset>
		<fieldset  class="setupFieldset"><label>5.&nbsp;Welches Audio-Sample hat eine bessere Qualität als das Andere? </label>

		<div class="row" style="margin-top:10px;">
				<div class="col-sm-4">
					<div align="right"> <span class="baudio" id="CMP3_A" title="Audio A" data-src="${CMP3_A}" >&nbsp;</span> </div>
				</div>
				<div class="col-sm-4"></div>
				<div class="col-sm-4">
					<div align="left"> <span class="baudio" id="CMP3_B" title="Audio B" data-src="${CMP3_B}" >&nbsp;</span> </div>
				</div>
		</div>

		<div class="row">
				<div class="col-sm-4"></div>
				<div class="col-sm-5">
					<div class="radio"><label><input type="radio" name="cmp3" required="" value="a">Die Qualität von <b>Audio A</b> ist besser.</label></div>
					<div class="radio"><label><input type="radio" name="cmp3" required="" value="o">Es ist <b>kein Unterschied hörbar</b>.</label></div>
					<div class="radio"><label><input type="radio" name="cmp3" required="" value="b">Die Qualität von <b>Audio B</b> ist besser.</label></div>
				</div>
				<div class="col-sm-3"></div>
		</div>

		</fieldset>

		<fieldset  class="setupFieldset"><label>6.&nbsp;Welches Audio-Sample hat eine bessere Qualität als das Andere? </label>


		<div class="row" style="margin-top:10px;">
				<div class="col-sm-4">
					<div align="right"> <span class="baudio" id="CMP4_A" title="Audio A" data-src="${CMP4_A}" >&nbsp;</span> </div>
				</div>
				<div class="col-sm-4"></div>
				<div class="col-sm-4">
					<div align="left"> <span class="baudio" id="CMP4_B" title="Audio B" data-src="${CMP4_B}" >&nbsp;</span> </div>
				</div>
		</div>

		<div class="row">
				<div class="col-sm-4"></div>
				<div class="col-sm-5">
					<div class="radio"><label><input type="radio" name="cmp4" required="" value="a">Die Qualität von <b>Audio A</b> ist besser.</label></div>
					<div class="radio"><label><input type="radio" name="cmp4" required="" value="o">Es ist <b>kein Unterschied hörbar</b>.</label></div>
					<div class="radio"><label><input type="radio" name="cmp4" required="" value="b">Die Qualität von <b>Audio B</b> ist besser.</label></div>
				</div>
				<div class="col-sm-3"></div>
		</div>

		</fieldset>

	  </div>
  </div>
</div>

</section>
<!-- Setup  ends-->

<!-- Trainings-Abschnitt (Erscheint einmal pro Tag)-->
<section class="container" id="training">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title">
					<a data-target="#trainingS" data-toggle="collapse" >Training (alle <b class="training_time"> 0 </b> Stunden)</a>
				</h3>
			</div>
			<div  class="panel-collapse collapse in" id="trainingS">
				<div class="panel-body">
				<p> Bitte beantworten Sie die folgenden <b class="question_number_training"> 0 </b> Fragen. Für jede Frage, hören Sie sich bitte das Audio-Sample an und beurteilen Sie die Sprachqualität auf der folgenden Skala. <b>Beachten Sie</b>, dass die Skala erst aktiviert wird, wenn das Audio-Sample fertig abgespielt wurde. Falls Sie eine Unterbrechungs-Stimme hören, folgen Sie bitte ihren Anweisen.</p>
				<p> Es gibt keine richtige oder falsche Meinung, solange Sie gut zuhören und Ihre ehrliche Meinung geben</p>

 				<!-- will be generated -->
				<ul class="nav nav-tabs" role="tablist" id="trainingTabs">
				</ul>

				<div class="tab-content" id="nav-tabContent">


				</div>
			<div style="margin-top:0px;font-size:90%;text-align:center">Klicken Sie <b>next</b>, um alle <b class="question_number_training"> 0 </b> Fragen zu beantworten. Klicken Sie Submit, um Ihre Antwort abzusenden.</div>
			<nav aria-label="..." id="navNextPreT">
			  <ul class="pager">
				<li class="previous" onclick="showPreviousQuestionInTrainingSection();"><a href="#trainingTabs" class="page-link"  role="button"><span aria-hidden="true">&larr;</span>Previous</a></li>
				<li class="next" onclick="showNextQuestionInTrainingSection();"><a href="#trainingTabs" class="page-link"  role="button">Next <span aria-hidden="true">&rarr;</span></a></li>
			  </ul>
			</nav>

			</div>
			</div>
		</div>

</section>
<!-- Training section ends-->

<input id="tp_check" name="tp_check" type="hidden" value="-1" />
<input id="gq_check" name="gq_check" type="hidden" value="-1" />
<input id="errors" name="errors" type="hidden" value="" />

<input id="browser_info" name="browser_info" type="hidden" value="-1" maxlength="2000"/>
<input id="webrtc_raw" name="webrtc_raw" type="hidden" value="-1" maxlength="2000"/>
<input id="use_headset" name="use_headset" type="hidden" value="-1" />

<input id="time_page_hidden_sec" name="time_page_hidden_sec" type="hidden" value="0" />
<input id="any_parallel_session" name="any_parallel_session" type="hidden" value="false" />
<!--- Rating task -->
<section class="container" id="rating_section">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title">Ratings</h3>
			</div>
			<div class="panel-body">
				<p> Bitte beantworten Sie die folgenden <b class="question_number"> 0 </b> Fragen. Für jede Frage, hören Sie sich bitte das Audio-Sample an und beurteilen Sie die Sprachqualität auf der folgenden Skala. <b>Beachten Sie</b>, dass die Skala erst aktiviert wird, wenn das Audio-Sample fertig abgespielt wurde. Falls Sie eine Unterbrechungs-Stimme hören, folgen Sie bitte ihren Anweisen.</p>
				<p> Es gibt keine richtige oder falsche Meinung, solange Sie gut zuhören und Ihre ehrliche Meinung geben</p>

 				<!-- will be generated -->
				<ul class="nav nav-tabs" role="tablist" id="nav-tab-ul"> </ul>
				<!-- will be generated -->
				<div class="tab-content" id="nav-tabContent-rating">	</div>
				<div style="margin-top:0px;font-size:90%;text-align:center">Klicken Sie <b>next</b>, um alle <b class="question_number_training"> 0 </b> Fragen zu beantworten. Klicken Sie Submit, um Ihre Antwort abzusenden.</div>
				<nav aria-label="..." id="navNextPre">
				  <ul class="pager">
					<li class="previous" id="prev-rating" onclick="showPreviousQuestionInRatingSection();"><a href="#navNextPre" class="page-link"  role="button" ><span aria-hidden="true">&larr;</span>Previous</a></li>
					<li class="next" id= "next-rating" onclick="showNextQuestionInRatingSection();" ><a href="#navNextPre" class="page-link"  role="button">Next <span aria-hidden="true">&rarr;</span></a></li>
				  </ul>
				</nav>

			</div>
		</div>
</section>


<section class="container" id="thanks">
	<p>Danke für Ihre Teilnahme. Gerne können Sie mehr Hits aus dieser Gruppe bearbeiten, wenn diese verfügbar sind.</p>
</section>

<section class="container" id="max_allowed_HITs_reached" hidden>
	<p><h2>Gut gemacht! </h2> Sie haben die maximal erlaubte Anzahl an HITs bearbeitet.</p>

	<div class="alert alert-danger" role="alert">
		<img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/attention.png" alt="attention">
			  <b>Achtung:</b> Mehr als die vorgegebene Menge an HITs zu bearbeiten ist verboten und führt zum Ablehnen aller bearbeiteten HITs.
			</div>

</section>

<section class="container" id="qualification_rejected" hidden>
	<p>Leider gibt es für Ihr Profil keine Aufgauben. Bitte probieren Sie es in zwei Wochen erneut.
	Vielen Dank für Ihre Teilnahme.</p>

	<div class="alert alert-danger" role="alert">
		<img src="https://audiosamplesp808.blob.core.windows.net/p808-assets/img/attention.png" alt="attention">
			  <b>Achtung:</b> Jeder Versuch trotzdem HITs zu bearbeiten ist verboten und führt zum Ablehnen aller bearbeiteten HITs.
			</div>
</section>


